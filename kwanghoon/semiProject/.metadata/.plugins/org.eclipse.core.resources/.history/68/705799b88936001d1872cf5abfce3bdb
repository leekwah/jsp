<%@page import="login.UserBean"%>
<%@page import="login.UserDBBean"%>
<%@page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<% 
	//request.getParameter() 메서드를 통해서 id와 pwd를 받는다.
	String id = request.getParameter("mem_uid"); // "" 안에는 login.jsp에 name을 적어둔 변수를 적는다.  
	String pwd = request.getParameter("mem_pwd");

	UserDBBean manager = UserDBBean.getInstance();
	// getInstance() 메서드를 통해서 manager 객체 생성
	int check = manager.userCheck(id, pwd); // check 변수로 대입한다.
											// 1, 0, -1 로 처리한다.
	UserBean ur = manager.getUser(id); // 회원정보를 mb 객체로 대입한다.
	
	// mb 객체가 null이면
	if (mb == null) { 
%>
	<script>
		alert("존재하지 않는 회원");
		history.go(-1) // history.go(-1) 메서드를 통해서 이전으로 간다.
	</script>
<%
	//회원정보가 있는 상태
	} else {
		String name = mb.getMem_name();
		// mb객체의 name을 받아서, String name으로 대입한다. 
		if (check == 1) {
			// session 을 넘겨서, main에서 출력한다.
			// main.jsp 로 이동하기 전에, session에 추가한다.
			session.setAttribute("uid", id); // setAttribute() 메서드를 통해서 추가한다.
			session.setAttribute("name", name);
			session.setAttribute("Member", "yes"); // 회원일 경우 yes값을 준다.
			response.sendRedirect("main.jsp"); // main.jsp로 이동
		} else if (check == 0) {
%>
			<script>
				alert("비밀번호가 맞지 않습니다.");
				history.go(-1) // history.go(-1) 메서드를 통해서 이전으로 간다.
				// document.location.href="login.jsp";
			</script>
<%
		} else {
%>
			<script>
				alert("아이디가 맞지 않습니다.");
				// history.go(-1) // history.go(-1) 메서드를 통해서 이전으로 간다.
				document.location.href="login.jsp"; // documents 객체를 통해 login.jsp로 이동
			</script>
<%
		}
	}
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>loginOK</title>
</head>
<body>

</body>
</html>